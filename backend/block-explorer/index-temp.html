<!DOCTYPE html>

<html>
  <head>
    <title>Block Explorer</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
      integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootswatch@5.1.3/dist/yeti/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css"
    />
    <!-- <link
      rel="stylesheet"
      type="text/css"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    /> -->
  </head>

  <body ng-app="BlockExplorer">
    <nav class="navbar navbar-light bg-light">
      <div class="container-fluid">
        <a
          class="navbar-brand"
          href="https://github.com/passandscore"
          target="_blank"
          rel="noreferrer"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="30"
            height="30"
            fill="currentColor"
            class="bi bi-github"
            viewBox="0 0 16 16"
          >
            <path
              d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"
            />
          </svg>

          passandscore
        </a>
      </div>
    </nav>
    <div class="container" ng-controller="MainController">
      <div class="row">
        <div class="col-md-8 offset-md-2">
          <h1 id="page-title">Block Explorer</h1>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 offset-md-3">
          <!-- <form ng-submit="search(searchValue)">
            <div class="form-group">
              <input type="text" class="form-control" ng-model="searchValue" />
            </div>
            <div class="form-group">
              <select class="form-control" ng-model="searchType">
                <option value="block">Block Hash</option>
                <option value="transaction">Transaction ID</option>
                <option value="address">Address</option>
              </select>
            </div>
            <button
              type="submit"
              class="btn btn-primary margin-auto btn-search"
            >
              Search
            </button>
            <p
              ng-if="!block && !transaction && !addressData && initialSearchMade"
              class="no-data-text"
            >
              No data found for search.
            </p>
          </form> -->

          <form>
            <fieldset disabled>
              <legend>Disabled fieldset example</legend>
              <div class="mb-3">
                <label for="disabledTextInput" class="form-label"
                  >Disabled input</label
                >
                <input
                  type="text"
                  id="disabledTextInput"
                  class="form-control"
                  placeholder="Disabled input"
                />
              </div>
              <div class="mb-3">
                <label for="disabledSelect" class="form-label"
                  >Disabled select menu</label
                >
                <select id="disabledSelect" class="form-select">
                  <option>Disabled select</option>
                </select>
              </div>
              <div class="mb-3">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="disabledFieldsetCheck"
                    disabled
                  />
                  <label class="form-check-label" for="disabledFieldsetCheck">
                    Can't check this
                  </label>
                </div>
              </div>
              <button type="submit" class="btn btn-primary">Submit</button>
            </fieldset>
          </form>
        </div>
      </div>
      <div class="row">
        <div class="col-md-10 offset-md-1">
          <!-- 'display block' table -->
          <h3 class="table-title" ng-if="block">Block</h3>
          <table class="table table-striped" ng-if="block">
            <tbody>
              <tr>
                <td class="bold">Block Hash</td>
                <td>{{ block.hash }}</td>
              </tr>
              <tr>
                <td class="bold">Index</td>
                <td>{{ block.index }}</td>
              </tr>
              <tr>
                <td class="bold">Time Stamp</td>
                <td>{{ block.timestamp }}</td>
              </tr>
              <tr>
                <td class="bold">Nonce</td>
                <td>{{ block.nonce }}</td>
              </tr>
              <tr>
                <td class="bold">Previous Hash</td>
                <td>{{ block.previousBlockHash }}</td>
              </tr>
              <tr>
                <td class="bold">Number Transactions</td>
                <td>{{ block.transactions.length }}</td>
              </tr>
            </tbody>
          </table>
          <!-- end 'display block' table -->

          <!-- 'display transaction' table -->
          <h3 class="table-title" ng-if="transaction">Transaction</h3>
          <table class="table table-striped" ng-if="transaction">
            <tbody>
              <tr>
                <td class="bold">Sender</td>
                <td>{{ transaction.sender }}</td>
              </tr>
              <tr>
                <td class="bold">Recipient</td>
                <td>{{ transaction.recipient }}</td>
              </tr>
              <tr>
                <td class="bold">Amount</td>
                <td>{{ transaction.amount }}</td>
              </tr>
            </tbody>
          </table>
          <!-- end 'display transaction' table -->

          <!-- 'display address' table -->
          <h3 class="table-title" ng-if="addressData">Address</h3>
          <p id="balance-text" ng-if="addressData">
            (Balance: {{ addressData.addressBalance }})
          </p>
          <table class="table table-striped" ng-if="addressData">
            <thead>
              <tr>
                <th scope="col">Sender</th>
                <th scope="col">Recipient</th>
                <th scope="col">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="transaction in addressData.addressTransactions">
                <td>{{ transaction.sender }}</td>
                <td>{{ transaction.recipient }}</td>
                <td>{{ transaction.amount }}</td>
              </tr>
            </tbody>
          </table>
          <!-- end 'display address' table -->
        </div>
      </div>
    </div>

    <script>
      window.app = angular.module("BlockExplorer", []);

      app.controller("MainController", function ($scope, $http) {
        $scope.block = null;
        $scope.transaction = null;
        $scope.addressData = null;
        $scope.initialSearchMade = false;

        $scope.fetchBlock = function (blockHash) {
          $http.get(`/block/${blockHash}`).then((response) => {
            $scope.block = response.data.block;
            $scope.transaction = null;
            $scope.addressData = null;
          });
        };

        $scope.fetchTransaction = function (transactionId) {
          $http.get(`/transaction/${transactionId}`).then((response) => {
            console.log(response.data.transaction);
            $scope.transaction = response.data.transaction;
            $scope.block = null;
            $scope.addressData = null;
          });
        };

        $scope.fetchAddressData = function (address) {
          $http.get(`/address/${address}`).then((response) => {
            $scope.addressData = response.data.addressData;
            if (!$scope.addressData.addressTransactions.length)
              $scope.addressData = null;
            $scope.block = null;
            $scope.transaction = null;
          });
        };

        $scope.search = function (searchValue) {
          $scope.initialSearchMade = true;
          if ($scope.searchType === "block") {
            $scope.fetchBlock(searchValue);
          } else if ($scope.searchType === "transaction") {
            $scope.fetchTransaction(searchValue);
          } else if ($scope.searchType === "address") {
            $scope.fetchAddressData(searchValue);
          }
        };
      });
    </script>

    <style type="text/css">
      html,
      body {
        min-height: 100vh;
        background-color: #e8e8e8;
      }
      .container {
        padding-top: 50px;
        padding-bottom: 50px;
      }
      #page-title {
        text-align: center;
        margin-bottom: 40px;
      }
      .table-title {
        margin-bottom: 20px;
        text-align: center;
      }
      .table {
        background-color: #ffffff;
        box-shadow: 2px 2px 15px -3px rgba(0, 0, 0, 0.75);
      }
      #balance-text {
        text-align: center;
        margin-top: -20px;
        margin-bottom: 30px;
      }
      .margin-auto {
        margin: auto;
        display: block;
      }
      .btn-search {
        margin-bottom: 50px;
      }
      .bold {
        font-weight: 700;
      }
      .no-data-text {
        color: red;
        text-align: center;
      }
    </style>
  </body>
</html>
